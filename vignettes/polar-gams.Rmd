---
title: "Using generalised additive models (GAM) with polar coordinates for assessing tongue contours"
author: "Stefano Coretta"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Polar GAMs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(tidyverse)
theme_set(theme_bw())
library(rticulate)
```

# Read data

The package `rticulate` comes with a dataset containg spline data from two speakers of Italian.

```{r load-data}
library(rticulate)
data(tongue)
tongue
```

# Fit a polar GAM

The spline data is in cartesian coordinates. The function `polar_gam()` converts the coordinates to polar and fits a GAM to the data.
The polar coordinates are calculated based on the origin of the probe, which is estimated if `origin = NULL` using the fan lines specified with the argument `fan_lines` (the defaults are `c(10, 25)`).

If you get an error relating to `lm.fit`, try to change the `fan_lines` to values different from the default.

```{r polar-place}
tongue_it05 <- filter(tongue, speaker == "it05", vowel == "a", fan_line < 38) %>% droplevels()

polar_place <- polar_gam(
  Y ~
    s(X, by = c2_place),
  data = tongue_it05
)
summary(polar_place)
```

The output model is in polar coordinates but it contains the origin coordinates so that plotting can be done in cartesian coordinates.

We can now plot the results from the model with `plot_polar_smooths()`.

```{r plot-smooths}
plot_polar_smooths(
  polar_place,
  X,
  c2_place
) +
  theme(legend.position = "top")
```

# Multiple predictors

It is possibe to specify multiple predictors in the model and then facet the plots.

```{r polar-multi}
tongue_it05 <- filter(tongue, speaker == "it05", fan_line < 38) %>% droplevels()

polar_multi <- polar_gam(
  Y ~
    s(X, by = c2_place) +
    s(X, by = vowel),
  data = tongue_it05
)
summary(polar_multi)
```

Th argument `facet_terms` can be used to specify the terms for the facets.
If you desire to facet by more then one term, just add multiple terms separated by `+` (for example, `facet_terms = vowel + voicing`; only terms that have been included in the model can be used for faceting, for more examples see the vignettes of the tidymv package).

```{r plot-smooths-2}
plot_polar_smooths(
  polar_multi,
  X,
  c2_place,
  facet_terms = vowel
) +
  theme(legend.position = "top")
```
